var orangeCommonApp=orangeCommonApp||{};orangeCommonApp.app=angular.module("orangeCommonApp",["ui.bootstrap","ngMaterial","ngMessages","textAngular","ngWYSIWYG","colorpicker.module","ngCookies"]);orangeCommonApp.app.value("moduleApp","0");orangeCommonApp.app.config(function(n,t,i){i.decorator("taOptions",["taRegisterTool","$delegate",function(n,t){return n("backgroundColor",{display:"<button colorpicker class='btn btn-default ng-scope' title='Background Color' type='button' colorpicker-close-on-select colorpicker-position='bottom' ng-model='backgroundColor' style='background-color: {{backgroundColor}}'><i class='fa fa-paint-brush'><\/i><\/button>",action:function(n){var t=this;this.$editor().wrapSelection("backgroundColor",this.backgroundColor);typeof t.listener=="undefined"&&(t.listener=t.$watch("backgroundColor",function(n){t.$editor().wrapSelection("backColor",n)}));t.$on("colorpicker-selected",function(){n.resolve()});t.$on("colorpicker-closed",function(){n.resolve()});return}}),t.toolbar[1].unshift("backgroundColor"),n("fontColor",{display:"<button colorpicker type='button' class='btn btn-default ng-scope'  title='Font Color'  colorpicker-close-on-select colorpicker-position='bottom' ng-model='fontColor' style='color: {{fontColor}}'><i class='fa fa-font '><\/i><\/button>",action:function(n){var t=this;return typeof t.listener=="undefined"&&(t.listener=t.$watch("fontColor",function(n){t.$editor().wrapSelection("foreColor",n)})),t.$on("colorpicker-selected",function(){n.resolve()}),t.$on("colorpicker-closed",function(){n.resolve()}),!1}}),t.toolbar[1].unshift("fontColor"),t.setup.textEditorSetup=function(n){n.attr("ui-codemirror","")},t}]);i.decorator("taOptions",["taCustomRenderers","$delegate",function(n,t){return n.push({selector:"a",renderLogic:function(n){n.attr("target","_blank");n.attr("dummu","super")}}),t}]);location.hostname!=="localhost"&&location.hostname!=="127.0.0.1"&&n.debugInfoEnabled(!1);t.defaults.withCredentials=!0;t.interceptors.push(function(n){return n.activeCalls==undefined&&(n.activeCalls=0),n.errorResponse==undefined&&(n.errorResponse=!1),{request:function(t){return n.overrideCodeAlliance=JSON.parse(sessionStorage.getItem("Epilot.OverrideCodeAlliance")),n.overrideCodeAlliance&&(t.headers.overrideCodeAlliance=n.overrideCodeAlliance.CodeAlliance),n.delegateUser=JSON.parse(sessionStorage.getItem("Epilot.Perfco.DelegationActor")),n.delegateUser&&(t.url.includes($("#PropertyDrcePVCWebApiUrl").text())||t.url.includes($("#PropertyPVVWebApiUrl").text())||(t.headers.delegateUser=n.delegateUser.SourceCodeAlliance)),n.delegatePvcUser=JSON.parse(sessionStorage.getItem("Epilot.Pvc.DelegationActor")),n.delegatePvcUser&&(t.headers.delegateUser=n.delegatePvcUser.SourceCodeAlliance),n.delegatePvvUser=JSON.parse(sessionStorage.getItem("Epilot.Pvv.DelegationActor")),n.delegatePvvUser&&(t.headers.delegateUser=n.delegatePvvUser.SourceCodeAlliance),n.activeCalls+=1,t},requestError:function(t){return n.activeCalls-=1,t},response:function(t){return n.activeCalls-=1,t},responseError:function(t){return n.activeCalls-=1,n.errorhttp=t,t}}})});orangeCommonApp.app.controller("baseCommonController",function(n,t,i,r,u,f,e){u.setCurrentLang("fr");e.LOG_DEBUG_MESSAGES=!1;n.Format=n.Format||{};n.WebService=n.WebService||{};n.WebService.Url="";n.Page=n.Page||{};n.Page.IsPeriodeLess=!1;n.Grid=n.Grid||{};n.Grid.IsEditable=!0;n.Grid.Filtres=n.Grid.Filtres||{};n.Grid.Filtres.Actif=[{value:!0,label:"Actif"},{value:!1,label:"Inactif"}];n.Grid.Pagination=n.Grid.Pagination||{};n.Grid.Pagination.LocalStorage=localStorage.getItem("EPilot.Pagination.CurrentValue");n.Grid.Pagination.Sizes=[10,50,200,500];n.Grid.Pagination.Size=n.Grid.Pagination.LocalStorage?n.Grid.Pagination.LocalStorage:10;n.Grid.Options={enableSorting:!0,enableFiltering:!0,enableGridMenu:!0,enableSelectAll:!1,enableHorizontalScrollbar:0,enableVerticalScrollbar:1,rowTemplate:"/_layouts/15/Orange.Common/Design/Scripts/app/views/grid/rowTemplate.html?version=EPilotCurrentVersion",enablePaginationControls:!1,paginationCurrentPage:1,paginationPageSize:n.Grid.Pagination.Size,paginationPageSizes:n.Grid.Pagination.Sizes};n.Grid.Options.onRegisterApi=function(t){n.Grid.Api=t;n.Grid.Api.core.on.sortChanged(n,function(n,t){while(t.length>1)t[0].unsort(),t.shift()})};n.Grid.SortingAlgorithm=n.Grid.SortingAlgorithm||{};n.Grid.SortingAlgorithm.SortByDate=function(t,i){var f=n.Grid.Api.core.sortHandleNulls(t,i),r,u;return f!==null?f:(r=moment(t,"YYYY-MM-DD").toDate(),u=moment(i,"YYYY-MM-DD").toDate(),r<u?-1:r>u?1:0)};n.Grid.SortingAlgorithm.SortByDouble=function(t,i){var f=n.Grid.Api.core.sortHandleNulls(t,i),r,u;return f!==null?f:(r=parseFloat(t),u=parseFloat(i),r<u?-1:r>u?1:0)};n.Grid.Resize=function(t){localStorage.setItem("EPilot.Pagination.CurrentValue",t);n.Grid.Options.paginationPageSize=t;n.Grid.Options.virtualizationThreshold=t};n.Agence=n.Agence||{};n.Agence.All=[];n.Agence.AllFormatted=[];n.Agence.AllFormattedCopy=[];n.Agence.Current=null;n.Boutons=n.Boutons||{};n.Boutons.AreActive=function(){return!0};n.Boutons.Import=n.Boutons.Import||{};n.Boutons.Import.Name="Importer";n.Boutons.Import.RequireAgenceSelected=!1;n.Boutons.Import.IsActive=function(){return n.Boutons.Import.RequireAgenceSelected&&!n.Agence.Current?!1:n.Periode.DefaultPeriode?n.Periode.DefaultPeriode.Period==n.Periode.Current.Period:!0};n.ImportPopup=n.ImportPopup||{};n.ImportPopup.Title="";n.ImportPopup.Open=function(){n.Page.IsEditable()&&f.open({animation:!0,templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/import.html?version=EPilotCurrentVersion",controller:"importPopupController",controllerAs:"vm",resolve:{currentPeriod:function(){return n.Periode.Current},currentAgence:function(){return n.Agence.Current},urls:function(){return n.urls},title:function(){return n.ImportPopup.Title},refreshGrid:function(){return function(){n.fillGrid()}},currentDomain:function(){return null}},size:"lg"})};n.exportToExcel=function(){var t=n.WebService.Url+"/"+n.urls.exportToExcel;n.Periode.Current&&(t+="/"+n.Periode.Current.Id);n.urls.sendCodeAgence?t+="/"+n.selectedAgencyName:n.selectedAgencyId&&(t+="/"+n.selectedAgencyId);window.open(t,"_blank")};n.jQueryScrollbarOptions={onScroll:function(){}};n.urls=[];n.EditPopup=n.EditPopup||{};n.EditPopup.Size="lg";n.EditPopup.DefaultTemplate="/_layouts/15/Orange.Common/Design/Scripts/app/views/gridPopup.html?version=EPilotCurrentVersion";n.EditPopup.OverridenTemplateUrl="";n.EditPopup.LoadParameters=function(){};n.EditPopup.OpenAdd=function(){if(n.Page.IsEditable()){var t=f.open({animation:!0,templateUrl:n.EditPopup.OverridenTemplateUrl?n.EditPopup.OverridenTemplateUrl:n.EditPopup.DefaultTemplate,backdrop:"static",keyboard:!1,controller:n.popupController,controllerAs:"vm",size:n.EditPopup.Size,resolve:{isNewForm:!0,grid:function(){return n.Grid.Options},row:function(){return undefined},params:function(){return n.EditPopup.LoadParameters()}}});t.result.then(function(t){n.EditPopup.EventHandlers.ItemAdded(t)})}};n.EditPopup.OpenEdit=function(t,i,r){if(t.preventDefault(),n.Page.IsEditable()&&n.Grid.IsEditable){var u=f.open({animation:!0,templateUrl:n.EditPopup.OverridenTemplateUrl?n.EditPopup.OverridenTemplateUrl:n.EditPopup.DefaultTemplate,backdrop:"static",keyboard:!1,controller:n.popupController,controllerAs:"vm",size:n.EditPopup.Size,resolve:{isNewForm:!1,grid:function(){return n.Grid.Options},row:function(){return r},params:function(){return n.EditPopup.LoadParameters()}}});u.result.then(function(t){n.EditPopup.EventHandlers.ItemUpdated(t)})}};n.EditPopup.EventHandlers=n.EventHandlers||{};n.EditPopup.EventHandlers.ItemAdded=function(){};n.EditPopup.EventHandlers.ItemUpdated=function(){};n.Page.IsEditable=function(){return n.Periode.DefaultPeriode?n.Periode.DefaultPeriode.Period==n.Periode.Current.Period:!0};n.Format.ObjectToListBox=function(n,t,i,r,u){for(var f,o=[],e=0,s=n.length;e<s;e++)f=n[e],o.push({value:u?f[r].toString():f[r],name:f[t]+"-"+f[i]});return o};n.mapSelectData=function(n,t,i){for(var u,f=[],r=0,e=n.length;r<e;r++)u=n[r],f.push({value:u[i],name:u[t]});return f};n.getArrayElement=function(t,i,r){return t[n.getArrayElementIndex(t,i,r)]};n.getArrayElementIndex=function(n,t,i){for(var r=0,u=n.length;r<u;r++)if(n[r][t]==i)return r};n.Periode=n.Periode||{};n.Periode.All=[];n.Periode.AllYears=[];n.Periode.DefaultPeriode=null;n.Periode.Current=null;n.Periode.CurrentYear=null;n.Periode.Selecteur=n.Periode.Selecteur||{};n.Periode.Selecteur.PeriodesFiltreParAnnee=[];n.Periode.Selecteur.TempPeriode=null;n.Periode.Selecteur.TempPeriodeShortValue=null;n.Periode.SetDefault=function(t){n.Periode.DefaultPeriode=t;n.Periode.Current=t;n.Periode.Current.Period=t.Libelle;n.Periode.CurrentYear=t.Libelle.split("-")[1];n.Periode.Selecteur.TempPeriodeShortValue=t.Libelle.split("-")[0];n.Periode.ExtractAllYear()};n.Periode.ExtractAllYear=function(){n.Periode.All.forEach(function(t){var r=t.Libelle.split("-"),i=r[1];n.Periode.AllYears.indexOf(i)==-1&&n.Periode.AllYears.push(i)})};n.Periode.Selecteur.SelectYear=function(t,i){n.Periode.Selecteur.PeriodesFiltreParAnnee=[];n.Periode.CurrentYear=t;n.Periode.All.forEach(function(i){var r=i.Libelle.split("-"),u=r[1],f=r[0];t==u&&(i.shortPeriod=f,n.Periode.Selecteur.PeriodesFiltreParAnnee.push(i))});!i&&n.Periode.All&&n.Periode.All.length>0&&(n.Periode.Selecteur.TempPeriodeShortValue=n.Periode.Selecteur.PeriodesFiltreParAnnee[0].shortPeriod,n.Periode.Selecteur.TempPeriode=n.Periode.Selecteur.PeriodesFiltreParAnnee[0])};n.Periode.Selecteur.SelectPeriode=function(t){n.Periode.Selecteur.TempPeriodeShortValue=t.shortPeriod;n.Periode.Selecteur.TempPeriode=t};n.Periode.Selecteur.Save=function(){n.Periode.Selecteur.TempPeriode&&(!n.Periode.Current||n.Periode.Current.Period!=n.Periode.Selecteur.TempPeriode.Period)&&(n.Periode.Current=n.Periode.Selecteur.TempPeriode,n.Periode.Current.Period=n.Periode.Current.Libelle,n.fillGrid())};$("#aspnetForm").on("click",function(n){let t=$(".com-top-selector-period .popover.fade.in");if(t.length>0){if($(n.target).length==0)return;if($(n.target)[0].className=="dropdown-toggle baseddt"||$(n.target)[0].className=="popover-content"||$(n.target)[0].className=="popover-title"||$(n.target)[0].className=="dropdown-toggle text-select-period"||$(n.target)[0].className=="selector-year"||$(n.target)[0].className=="selector-period")return;$(".com-top-selector-period button.dropdown-toggle").click()}})});orangeCommonApp.app.controller("basePopupCommonController",function(n,t,i,r){n.isNewForm=t;n.showDeleteButton=!1;n.info=null;n.warning=null;n.error=null;n.entity=n.isNewForm?{}:angular.copy(r.entity);n.decimalColumns=[];n.showOtherButton=!1;n.otherButtonAction=function(){};n.otherButtonName=null;n.disabledSave=!1;n.saveError="Une erreur est survenue, impossible de sauvegarder les données saisies";n.decimalUnder50Pattern="^(50|([0-9]|[1-4][0-9])([.,][0-9]{1,2})?)$";n.decimalUnder50FormatValidationMessage={"202":"La valeur acceptée doit être au format [xx,xx] et inférieure ou égale à 50"};n.decimalUnder100Pattern="^(100|([0-9]|[1-9][0-9])([.,][0-9]{1,2})?)$";n.decimalUnder100FormatValidationMessage={"202":"La valeur acceptée doit être au format [xxx,xx] et inférieure ou égale à 100"};n.decimalUnder999Pattern="^(([0-9]{1,3})([.,][0-9]{1,2})?)$";n.decimalUnder999FormatValidationMessage={"202":"La valeur acceptée doit être au format [xxx,xx]"};n.decimalUnder150Pattern="^(150|(([0-1][0-4][0-9])|[0-9]{0,2})([.,][0-9]{1,2})?)$";n.decimalUnder150FormatValidationMessage={"202":"La valeur acceptée doit être au format [xxx,xx] et inférieure ou égale à 150"};n.decimalUnder999NegativePattern="^-?(?:[0-9]{1,3}(?:[.,][0-9]{0,2})?)$";n.decimal18_2="^-?(?:[0-9]{1,16}(?:[.,][0-9]{1,2})?)$";n.decimal18_2FormatValidationMessage={"202":"La valeur acceptée doit être au format [xxxxxxxxxxxxxxxx,xx]"};n.decimal18_6="^-?(?:[0-9]{1,16}(?:[.,][0-9]{1,6})?)$";n.decimal18_6FormatValidationMessage={"202":"La valeur acceptée doit être au format [xxxxxxxxxxxxxxxx,xxxxxx]"};n.decimal4_2="^-?(?:[0-9]{1,2}(?:[.,][0-9]{1,2})?)$";n.decimal4_2FormatValidationMessage={"202":"La valeur acceptée doit être au format [xx,xx]"};n.decimal7_5="^-?(?:[0-9]{1,2}(?:[.,][0-9]{1,5})?)$";n.decimal7_5FormatValidationMessage={"202":"La valeur acceptée doit être au format [xx.xxxxx]"};n.dateFormatValidationMessage={checkDate:"Format jj/mm/aaaa"};n.baseValidationMessages={105:"La valeur n'est pas un nombre valide",0:"La valeur est incorrecte",101:"{{viewValue}} est inférieure à la valeur minimale autorisée de {{schema.minimum}}",102:"{{viewValue}} est égal au minimum exclusif de {{schema.minimum}}",103:"{{viewValue}} est supérieure à la valeur maximale autorisée de {{schema.maximum}}",104:"{{viewValue}} est égal au maximum exclusif de {{schema.maximum}}",201:"La valeur est trop longue ({{viewValue.length}} caractères), elle est limitée à {{schema.maxLength}} symboles",302:"Le champ est obligatoire"};n.validateDuplicate=function(n,t){for(var f,e,u=0;u<i.data.length;u++)if(f=i.data[u],e=r?r.entity.Id:0,f[t]===n&&f.Id!=e)return!1;return!0};n.validateDuplicateByOtherField=function(t,u,f){for(var o,s,e=0;e<i.data.length;e++)if(o=i.data[e],s=r?r.entity.Id:0,o[u]===t&&o.Id!=s&&o[f]==n.entity[f])return!1;return!0};n.validateDuplicateTwoFields=function(n,t,u,f){for(var o,s,e=0;e<i.data.length;e++)if(o=i.data[e],s=r?r.entity.Id:0,o[t]===n&&o[f]==u&&o.Id!=s)return!1;return!0};n.customDateValidator={checkDate:function(t){return n.validateDate(t)}};n.validateDate=function(n){var t;if(!n)return!0;if(t=/^(\d{1,2})[-\/](\d{1,2})[-\/](\d{4})$/.exec(n),t==null)return!1;var r=t[1],u=t[2]-1,f=t[3],i=new Date(f,u,r);return i.getDate()==r&&i.getMonth()==u&&i.getFullYear()==f};n.selectDefaultValue=function(n,t){var i=[];return i.push({name:n,value:t}),i};n.onSelectChange=function(t,i,r){for(var u=0,f=i.titleMap.length;u<f;u++)if(i.titleMap[u].value==t){n.entity[r]=i.titleMap[u].value;break}};n.getFormElementByKey=function(t){var i=null;return n.form.forEach(function(n){if(n.key&&n.key.indexOf(t)!==-1){i=n;return}!0&&n.items.forEach(function(n){if(n.key&&n.key.indexOf(t)!==-1){i=n;return}})}),i};n.getArrayElementIndex=function(n,t,i){for(var r=0,u=n.length;r<u;r++)if(n[r][t]==i)return r};n.formatDecimalValues=function(){angular.forEach(n.decimalColumns,function(t){n.entity[t]=n.fixDecimalFormat(n.entity[t])})};n.fixDecimalFormat=function(n,t){var i,r;return n?(i=n.toString(),i.indexOf(",")&&(i=i.replace(",",".")),r=parseFloat(i),r?r:i):t};n.mapSelectData=function(n,t,i){for(var u,f=[],r=0,e=n.length;r<e;r++)u=n[r],f.push({value:u[i],name:u[t]});return f}});orangeCommonApp.app.controller("confirmPopupController",function(n,t,i,r){var u=this;u.titleToShow=t;u.textToShow=i;u.htmlToShow=r});orangeCommonApp.app.controller("notificationCommonPopupController",function(n,t,i){var r=this;r.titleToShow=i.Titre;r.textToShow=i.Texte;r.item=i;r.doNotDisplay=function(){t.utilisateurNotificationSave(i).then(function(){n.close()},function(n){logger.logError("Impossible de sauvegarder cet élément: "+n.message,n)})}});orangeCommonApp.app.controller("infosPopupController",function(n,t,i,r){var u=this;u.titleToShow=t;u.textToShow=i;u.htmlToShow=r});orangeCommonApp.app.controller("infosPopupNotCloseableController",function(n,t,i,r){var u=this;u.titleToShow=t;u.textToShow=i;u.htmlToShow=r});orangeCommonApp.app.controller("displayTopController",function(n,t,i){n.Panel=n.Panel||{};n.Panel.SessionStorageKey="EPilot.Common.Panel.Selected";n.Panel.Change=function(t){if(t){let i=angular.copy(t);i.statut=!1;sessionStorage.setItem(n.Panel.SessionStorageKey,JSON.stringify(i))}else t=n.Panel.GetDefaultPanel();n.panelCurrent=t.panel;n.panelOpen=t.statut};n.Panel.GetDefaultPanel=function(){var t=sessionStorage.getItem(n.Panel.SessionStorageKey),r;return t?t.panel=="hierarchie"&&i!=1&&i!=2?{panel:"notification",statut:!1}:t?(r=JSON.parse(t),r.statut=!1,r):void 0:{panel:"notification",statut:!1}};n.Panel.AutoClose=function(){n.Panel.Open=!1;n.panelOpen=!1;t.$apply()};t.$watch(function(){return t.topPanel},function(t){n.Panel.Change(t)},!0);t.$watch(function(){return document.getElementsByClassName("hierarchie-top-button")},function(n){n.length==0?$(".button-topnav#hierarchie").css("display","none"):$(".button-topnav#hierarchie").css("display","inline-block")});t.$watch(function(){return document.getElementsByClassName("bloc-note-top-button")},function(n){n.length==0?$(".button-topnav#bloc-note").css("display","none"):$(".button-topnav#bloc-note").css("display","inline-block")});$("#page-body").on("click",function(){n.Panel.AutoClose()});$("#suiteBarLeft").on("click",function(){n.Panel.AutoClose()});$("#overlay-iframe").on("click",function(){n.Panel.AutoClose()})});orangeCommonApp.app.controller("notificationCommonController",function(n,t,i,r,u,f,e){var o=this;o.nbNotification=0;o.notifications=[];o.Panel=o.Panel||{};o.Panel.Name="notification";o.Panel.Open=!1;i("displayTopController",{$scope:o});o.initializePage=function(){e.count(u).then(function(n){o.nbNotification=n.data});e.getAllPopupNotificationActives().then(function(n){for(var i=0;i<n.data.length;i++)t.open({animation:!0,templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/notificationPopup.html?version=EPilotCurrentVersion",controller:"notificationCommonPopupController",controllerAs:"vm",resolve:{item:function(){return n.data[i]}}})})};o.Panel.Display=function(){(r.topPanel&&r.topPanel.panel==o.Panel.Name||(o.Panel.Open=!1),r.topPanel={panel:o.Panel.Name,statut:!o.Panel.Open},o.Panel.Open=!o.Panel.Open,o.notifications.length==0)&&o.Panel.Open&&(e.getAllActives(u).then(function(n){o.notifications=n.data;o.nbNotification=0}),f.trackEvent("Global - Onglets - Ouverture notification"))};o.enSavoirPlus=function(n){o.notifications.forEach(function(n){n.Limite=70});o.notifications[n].Lu=!0;o.notifications[n].Limite=300};o.jQueryScrollbarOptions={onScroll:function(){}};o.initializePage()});orangeCommonApp.app.controller("overrideUserController",function(n,t,i,r,u){var f=this;f.Panel=f.Panel||{};f.Panel.Name="overrideUser";f.Panel.Open=!1;f.CurrentUser=f.CurrentUser||{};f.CurrentUser.IsAdmin=!1;f.OverrideUser=f.OverrideUser||{};f.OverrideUser.Selected=null;f.OverrideUser.SearchText;t("displayTopController",{$scope:f});f.initializePage=function(){var n=sessionStorage.getItem("Epilot.OverrideCodeAlliance");n&&(f.OverrideUser.Selected=JSON.parse(n));f.CurrentUser.GetUser()};f.CurrentUser.GetUser=function(){r.getUser().then(function(n){n.status==200&&n.data&&n.data.IsAdmin&&(f.CurrentUser.IsAdmin=!0)})};f.Panel.Display=function(){i.topPanel&&i.topPanel.panel==f.Panel.Name||(f.Panel.Open=!1);i.topPanel={panel:f.Panel.Name,statut:!f.Panel.Open};f.Panel.Open=!f.Panel.Open;f.Panel.Open&&u.trackEvent("Global - Onglets - Ouverture override")};f.OverrideUser.Save=function(){sessionStorage.clear();f.Panel.Display();sessionStorage.setItem("Epilot.OverrideCodeAlliance",JSON.stringify(f.OverrideUser.Selected));location.reload()};f.OverrideUser.Delete=function(){f.OverrideUser.Selected=null;sessionStorage.clear();f.Panel.Display();location.reload()};f.OverrideUser.Search=function(n){return n?r.getAllUsers(n).then(function(n){if(n.status==200)return n.data}):[]};f.OverrideUser.Select=function(n){f.OverrideUser.Selected=n;f.OverrideUser.Save()};f.initializePage()});orangeCommonApp.app.controller("blocNoteController",function(n,t,i,r,u,f,e,o){var s=this;s.ActeurConnecte=null;s.Panel=s.Panel||{};s.Panel.Name="bloc-note";s.Panel.Open=!1;s.Panel.IndicateurNotesNonLu=0;s.Tabs=s.Tabs||{};s.Tabs.MesNotes="tabMesNotes";s.Tabs.Equipe="tabEquipe";s.Tabs.MonManager="tabMonManager";s.Tabs.Autres="tabAutre";s.Tabs.Current=s.Tabs.MesNotes;s.Tabs.Autre=s.Tabs.Autre||{};s.Tabs.Autre.Favoris=[];s.Filtre=s.Filtre||{};s.Filtre.Text=null;s.Notes=s.Notes||{};s.Notes.UtilisateurCodeAlliance=null;s.Notes.UtilisateurDisplayName=null;s.Notes.List=[];s.Notes.ListInternal=[];s.Notes.NouvelleNote=s.Notes.NouvelleNote||{};s.Notes.NouvelleNote.IsOpened=!1;s.Notes.NouvelleNote.Current={Titre:null,Texte:null,CodeDestinataire:null};s.Notes.NouvelleNote.Acteur=null;s.Notes.ModificationForm=s.Notes.ModificationForm||{};s.Notes.ModificationForm.IndexToEdit=-9;s.Notes.TailleTexteReduit=100;s.Commentaires=s.Commentaires||{};t("displayTopController",{$scope:s});s.Panel.Display=function(){i.topPanel&&i.topPanel.panel==s.Panel.Name||(s.Panel.Open=!1);i.topPanel={panel:s.Panel.Name,statut:!s.Panel.Open};s.Panel.Open=!s.Panel.Open;s.Panel.Open&&s.Notes.Load();s.Panel.Open&&e.trackEvent("Global - Onglets - Ouverture bloc note")};s.Tabs.Autre.Init=function(){u.getAllFavoris().then(function(n){s.Tabs.Autre.Favoris=n.data})};s.Tabs.Autre.SearchUser=function(n){return n?f.getAllUsers(n).then(function(n){if(n.status==200)return n.data}):[]};s.Tabs.Autre.Select=function(n){var t,i;n&&(t=!1,s.Tabs.Autre.Favoris.forEach(function(i){i.FavorisCodeAlliance==n.CodeAlliance&&(t=!0)}),t?(alert("L utilsateur est déja dans vos favoris."),s.Tabs.Autre.selectedItem=null):(i={CodeAlliance:n.CodeAlliance,FavorisCodeAlliance:n.CodeAlliance},u.saveFavoris(i).then(function(){s.Tabs.Autre.selectedItem=null;s.Tabs.Autre.Init();s.Notes.Load(s.Tabs.Autres,n.CodeAlliance,n.NomPrenom)})))};s.Tabs.Autre.Delete=function(n){u.deleteFavoris(n).then(function(){s.Tabs.Autre.Init()})};s.Filtre.Search=function(){if(!s.Filtre.Text){s.Notes.List=angular.copy(s.Notes.ListInternal);return}if(!(s.Filtre.Text.length<2)){let n=[];s.Notes.ListInternal.forEach(function(t){let i=moment(t.Date).format("DD/MM/YYYY");(t.Titre.toLowerCase().includes(s.Filtre.Text.toLowerCase())||t.Texte.toLowerCase().includes(s.Filtre.Text.toLowerCase())||t.NomPrenomCreateur.toLowerCase().includes(s.Filtre.Text.toLowerCase())||t.NomPrenomDestinataire.toLowerCase().includes(s.Filtre.Text.toLowerCase())||i.toLowerCase().includes(s.Filtre.Text.toLowerCase()))&&n.push(t)});s.Notes.List=n}};s.Notes.NouvelleNote.Display=function(){s.Notes.NouvelleNote.IsOpened=!0};s.Notes.NouvelleNote.Save=function(n){n.$valid&&(s.Notes.NouvelleNote.Current.CodeDestinataire=s.Notes.UtilisateurCodeAlliance?s.Notes.UtilisateurCodeAlliance:null,s.Notes.NouvelleNote.Current.Texte=s.formatTexteToHtml(s.Notes.NouvelleNote.Current.Texte),u.save(s.Notes.NouvelleNote.Current).then(function(){s.Notes.Load(s.Tabs.Current,s.Notes.UtilisateurCodeAlliance,s.Notes.UtilisateurDisplayName);s.Notes.NouvelleNote.Reset(n)}))};s.Notes.NouvelleNote.Reset=function(n){s.Notes.NouvelleNote.Current={Titre:null,Texte:null,CodeDestinataire:null};s.Notes.NouvelleNote.IsOpened=!1;n.$setPristine();n.$setUntouched()};s.Notes.Load=function(n,t,i){s.Notes.ModificationForm.IndexToEdit=-9;n=n?n:s.Tabs.MesNotes;s.Tabs.Current=n;n==s.Tabs.MesNotes?s.Notes.UtilisateurCodeAlliance=s.Notes.UtilisateurCodeAlliance=null:n==s.Tabs.MonManager?s.Notes.UtilisateurCodeAlliance=s.ActeurConnecte.ManagerCode:(s.Notes.UtilisateurCodeAlliance=t,s.Notes.UtilisateurDisplayName=i);u.getAll(n,s.Notes.UtilisateurCodeAlliance).then(function(n){n.data.forEach(function(n){n.Limite=s.Notes.TailleTexteReduit});s.Notes.ListInternal=n.data;s.Notes.List=angular.copy(s.Notes.ListInternal);s.Filtre.Text&&s.Filtre.Search()})};s.Notes.Delete=function(n,t){s.Notes.List[t].PeutModifier&&u.delete(n).then(function(){var r,i;for(s.Notes.List.splice(t,1),r=0,i=0;i<s.Notes.ListInternal.length;i++)if(s.Notes.ListInternal[i].Id==n){r=i;break}s.Notes.ListInternal.splice(r,1)})};s.Notes.EnSavoirPlus=function(n){s.Notes.List[n].Limite==s.Notes.TailleTexteReduit&&(s.Notes.List.forEach(function(n){n.Limite=s.Notes.TailleTexteReduit}),s.Notes.List[n].Limite=1200,s.Commentaires.Get(s.Notes.List[n]),s.Notes.List[n].Lu||u.read(s.Notes.List[n].Id).then(function(t){s.Notes.List[n].Lu=!0;s.Notes.ListInternal[n].Lu=!0;s.Panel.IndicateurNotesNonLu=t.data}))};s.Notes.ModificationForm.Open=function(n){s.Notes.List[n].PeutModifier&&(s.Notes.List[s.Notes.ModificationForm.IndexToEdit]&&(s.Notes.List[s.Notes.ModificationForm.IndexToEdit].Texte=s.formatTexteToHtml(s.Notes.List[n].Texte)),s.Notes.List[n].Texte=s.formatTexteToInput(s.Notes.List[n].Texte),s.Notes.ModificationForm.IndexToEdit=n)};s.Notes.ModificationForm.Save=function(n){s.Notes.List[n].Texte=s.formatTexteToHtml(s.Notes.List[n].Texte);u.save(s.Notes.List[n]).then(function(){for(var t=0;t<s.Notes.ListInternal.length;t++)s.Notes.ListInternal[t].Id==s.Notes.List[n].Id&&(s.Notes.ListInternal[t].Texte=s.Notes.List[n].Texte);s.Notes.ModificationForm.IndexToEdit=-9})};s.Notes.ModificationForm.Cancel=function(n){s.Notes.List[n].Texte=s.formatTexteToHtml(s.Notes.List[n].Texte);s.Notes.ModificationForm.IndexToEdit=-9};s.Commentaires.ChangeToRead=function(n){n.Lu=!0};s.Commentaires.Save=function(n){if(s.Notes.List[n].Commentaires||(s.Notes.List[n].Commentaires=[]),s.Notes.List[n].Commentaire){var t={IdNote:s.Notes.List[n].Id,Texte:s.Notes.List[n].Commentaire};u.saveCommentaire(t).then(function(t){s.Notes.List[n].Commentaires=t.data;s.Notes.List[n].NombreCommentaires++});s.Notes.List[n].Commentaire=null;s.Commentaires.AffecterNoteSource(s.Notes.List[n].Id,s.Notes.List[n].Commentaires)}};s.Commentaires.AffecterNoteSource=function(n,t){s.Notes.ListInternal.forEach(function(i){i.Id==n&&(i.Commentaires=t)})};s.Commentaires.Get=function(n){u.getAllCommentaires(n.Id).then(function(t){n.Commentaires=t.data;s.Commentaires.AffecterNoteSource(n.Id,n.Commentaires);u.readCommentaire(n.Id).then(function(){s.Panel.IndicateurNotesNonLu=s.Panel.IndicateurNotesNonLu-n.NombreCommentairesNonLus;n.NombreCommentairesNonLus=0})})};s.Commentaires.Delete=function(n,t){var i=s.Notes.List[n],r=i.Commentaires[t];u.deleteCommentaire(r.Id).then(function(){i.Commentaires.splice(t,1);i.NombreCommentaires--;s.Notes.ListInternal.forEach(function(n){var u=0,t;if(n.Id==i.Id){for(t=0;t<n.Commentaires.length;t++)if(n.Commentaires[t].Id==r.Id){u=t;break}n.Commentaires=i.Commentaires;return}})})};s.formatTexteToHtml=function(n){return n.replace(/\r?\n/g,"<br />")};s.formatTexteToInput=function(n){return n.replace(/<br \/>/g,"\n")};s.formatDestinataire=function(n){return n?n.indexOf(",")>0?"son équipe":n:""};s.jQueryScrollbarOptions={onScroll:function(){}};n.$watch(function(){return sessionStorage.getItem("Epilot.Perfco.Actor")},function(n){s.ActeurConnecte=JSON.parse(n)},!0);s.jouerTutorielVideo=function(){var n=o.open({animation:!0,size:"lg",templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/aide/aide-video.html?version=EPilotCurrentVersion",controller:"aideVideoPopupController",controllerAs:"vm",resolve:{videoTitre:function(){return"Sirtaki"},videoUrl:function(){return"/SiteCollectionDocuments/tuto8.mp4"},videoDuree:function(){return"Trop long !!!"}}})};s.initializePage=function(){u.count().then(function(n){s.Panel.IndicateurNotesNonLu=n.data});s.Tabs.Autre.Init()};s.initializePage()});orangeCommonApp.app.controller("aideVideoPopupController",function(n,t,i,r,u,f){var e=this;e.videoTitre=r;e.videoUrl=u;e.videoDuree=f;e.initializePage=function(){};e.initializePage()});orangeCommonApp.app.controller("aideController",function(n,t,i,r,u,f){var e=this;e.nbNotification=0;e.tutoriels=[];e.tutorielsVideos=[];e.modesOperatoires=[];e.Panel=e.Panel||{};e.Panel.Name="aide";e.Panel.Open=!1;t("displayTopController",{$scope:e});e.Panel.Display=function(){i.topPanel&&i.topPanel.panel==e.Panel.Name||(e.Panel.Open=!1);i.topPanel={panel:e.Panel.Name,statut:!e.Panel.Open};e.Panel.Open=!e.Panel.Open;e.Panel.Open&&f.trackEvent("Global - Onglets - Ouverture aide")};e.jouerTutoriel=function(n){f.trackEvent("Global - Aide - Didactitiel",{Tutoriel_Nom:n.nom});playTuto(n)};e.jouerTutorielVideo=function(n){f.trackEvent("Global - Aide - Tutoriel",{Tutoriel_Nom:n.nom});var t=r.open({animation:!0,size:"lg",templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/aide/aide-video.html?version=EPilotCurrentVersion",controller:"aideVideoPopupController",controllerAs:"vm",resolve:{videoTitre:function(){return n.nom},videoUrl:function(){return n.url},videoDuree:function(){return n.duree}}})};e.openModeOperatoire=function(n){window.open(n.url,"_blank")};e.jQueryScrollbarOptions={onScroll:function(){}};e.initializePage=function(){function n(n){return document.URL.toString().toLowerCase().indexOf(n.pattern.toLowerCase())!==-1}var t,i;tutoriels&&(tutoriels.forEach(function(t){n(t)&&e.tutoriels.push(t)}),t=[{ordre:1,episode:"Tuto#1",nom:"Prendre la place de...",url:"/SiteCollectionDocuments/tuto1.mp4",duree:"55s",pattern:"perfco"},{ordre:2,episode:"Tuto#2",nom:"CAP pour les ICS",url:"/SiteCollectionDocuments/tuto2.mp4",duree:"2 min 56s",pattern:"perfco/_layouts/15/Orange.EPilot/Pages/PlanAction.aspx"},{ordre:3,episode:"Tuto#3",nom:"CAP pour les VRC",url:"/SiteCollectionDocuments/tuto3.mp4",duree:"3 min 25s",pattern:"perfco/_layouts/15/Orange.EPilot/Pages/PlanAction.aspx"},{ordre:4,episode:"Tuto#4",nom:"Saisir ses engagements PO",url:"/SiteCollectionDocuments/tuto4.mp4",duree:"1 min 4s",pattern:"perfco/_layouts/15/Orange.EPilot/Pages/PrevisionSaisie.aspx"},{ordre:5,episode:"Tuto#5",nom:"Centre de téléchargement",url:"/SiteCollectionDocuments/tuto5.mp4",duree:"1 min 39s",pattern:"pvv"},{ordre:6,episode:"Tuto#6",nom:"Bloc-notes",url:"/SiteCollectionDocuments/tuto6.mp4",duree:"2 min 05s",pattern:"perfco"},{ordre:7,episode:"Tuto#7",nom:"La nouvelle TPS",url:"/SiteCollectionDocuments/tutoTPS1.mp4",duree:"5 min 26s",pattern:"tps"}],t.forEach(function(t){t.pattern?n(t)&&e.tutorielsVideos.push(t):e.tutorielsVideos.push(t)}),e.tutorielsVideos=u("orderBy")(e.tutorielsVideos,"ordre",!0),i=[{order:1,nom:"Pôle contrats",url:"/SiteCollectionDocuments/ModOp Epilot PC - 20190415.pptx",date:"17/06/2019",pattern:"perfco/Pages/PoleContrat.aspx"},{order:2,nom:"La nouvelle TPS ",url:"/SiteCollectionDocuments/ModeOp_Nouvelle_TPS_Online.pdf",date:"10/07/2019",pattern:"tps"},{order:3,nom:"Avant Vente",url:"/SiteCollectionDocuments/ModOpEpilotAVV.pptx",date:"26/02/2020",pattern:"perfco/Pages/Avv.aspx"},{order:4,nom:"Avant Vente",url:"/SiteCollectionDocuments/ModOpEpilotAVV_IAV.pptx",date:"26/02/2020",pattern:"perfco/Pages/AvvIAV.aspx"},{order:5,nom:"E-conformité",url:"/SiteCollectionDocuments/E-CONFORMITE_V2_Final.pdf",date:"29/04/2020",pattern:"perfco/Pages/E-conformite.aspx"}],i.forEach(function(t){t.pattern?n(t)&&e.modesOperatoires.push(t):e.modesOperatoires.push(t)}),e.modesOperatoires=u("orderBy")(e.modesOperatoires,"ordre",!0))};e.initializePage()});orangeCommonApp.app.controller("telechargementController",function(n,t,i,r,u,f,e){var o=this;o.Panel=o.Panel||{};o.Panel.Name="telechargement";o.Panel.Open=!1;o.Filtres=o.Filtres||{};o.telechargements=[];o.timer=12e4;t("displayTopController",{$scope:o});o.Panel.Display=function(){i.topPanel&&i.topPanel.panel==o.Panel.Name||(o.Panel.Open=!1);i.topPanel={panel:o.Panel.Name,statut:!o.Panel.Open};o.Panel.Open=!o.Panel.Open;o.Panel.Open&&u.trackEvent("Global - Onglets - Ouverture telechargement")};o.openTelechargement=function(n){n.StatusId==2?n.FichierUrl?(u.trackEvent("Global - Telechargement - Ouverture fichier"),window.open(n.FichierUrl,"_blank")):(u.trackEvent("Global - Telechargement - Fichier introuvable"),alert("Le fichier est introuvable")):confirm("Une erreur est survenue lors de la génération du fichier. \r\nVoulez-vous le recharger ?")&&(u.trackEvent("Global - Telechargement - Regeneration fichier"),f.updateStatus(n.Id,1).then(function(){o.initializePage()}))};o.getTelechargements=function(){f.get().then(function(t){o.telechargements=t;n.$$phase||n.$apply()})};o.delete=function(n,t){if(t){var i=r.open({animation:!0,templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/confirmPopup.html?version=EPilotCurrentVersion",controller:"confirmPopupController",controllerAs:"vm",resolve:{titleToShow:function(){return undefined},textToShow:function(){return undefined},htmlToShow:function(){return"Vous allez supprimer un téléchargement en cours?"}}});i.result.then(function(){f.updateStatus(n.Id,4).then(function(){o.initializePage()})})}else f.updateStatus(n.Id,4).then(function(){o.initializePage()})};o.Filtres.StatusEnAttente=function(n){return n.StatusId==1&&n.IsStarted==!1};o.Filtres.StatusEnCours=function(n){return n.StatusId==1&&n.IsStarted==!0};o.Filtres.StatusDisponible=function(n){return n.StatusId==2||n.StatusId==3};o.jQueryScrollbarOptions={onScroll:function(){}};setInterval(function(){e.get("EPilot.Telechargement.Update")&&(e.get("EPilot.Telechargement.Update")==!0||e.get("EPilot.Telechargement.Update")=="true")&&(o.initializePage(),e.put("EPilot.Telechargement.Update",!1,{path:"/"}),o.Panel.Open||$(".telechargement-top-button").click())},2e3);setInterval(function(){f.refresh().then(function(t){var u,i;t.refreshLocalStorage&&(!e.get("Epilot.LocalStorage.Refresh")||e.get("Epilot.LocalStorage.Refresh")!=moment().format("DD-MM-YYYY"));n:for(u=0;u<o.telechargements.length;u++)for(i=0;i<t.telechargements.length;i++)if(o.telechargements[u].Id===t.telechargements[i].Id&&o.telechargements[u].StatusId!=t.telechargements[i].StatusId&&(t.telechargements[i].StatusId==2||t.telechargements[i].StatusId==3)){r.open({animation:!0,templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/infosPopup.html?version=EPilotCurrentVersion",controller:"infosPopupController",controllerAs:"vm",resolve:{titleToShow:function(){return undefined},textToShow:function(){return undefined},htmlToShow:function(){return"Un ou plusieurs téléchargements sont disponibles"}}});break n}o.telechargements=t.telechargements;n.$apply()},function(n){console.log(n)})},o.timer);o.initializePage=function(){o.getTelechargements()};o.initializePage()});orangeCommonApp.app.controller("rechercheClientController",function(n,t,i,r,u,f,e){var o=this;o.Panel=o.Panel||{};o.Panel.Name="recherche-client";o.Panel.Open=!1;t("displayTopController",{$scope:o});o.siren;o._siren;o.selectedActeur;o.selectedProduit;o.selectedClient;o.niveau="";o.domaines=[];o.canAccess=!1;o.isCapa=!1;o.isClientNew=!1;o.idCapa;o.acteur={};o.produit={};o.client={};o.isClient=!0;o.isActeur=!1;o.isProduit=!1;o.isVendeur=!1;o.toggleBtn=function(n){n==1&&(o.isClient=!0,o.isActeur=!1,o.isProduit=!1);n==2&&(o.isClient=!1,o.isActeur=!0,o.isProduit=!1);n==3&&(o.isClient=!1,o.isActeur=!1,o.isProduit=!0)};o.initializePage=function(){e.getUser().then(function(n){if(n.status==200&&n.data){o.isVendeur=n.data.PopulationCode=="IC"||n.data.PopulationCode=="RCT"||n.data.PopulationCode=="AM"||n.data.PopulationCode=="AUTRES-VENDEURS"||n.data.PopulationCode=="ICS"?!0:!1;var t=$("#PropertyFicheClientRestrictedAccess").text().split(";").filter(Boolean);t.indexOf(n.data.PopulationCode)==-1?$("#recherche-client").show():$("#recherche-client").hide()}})};o.Panel.Display=function(){i.topPanel&&i.topPanel.panel==o.Panel.Name||(o.Panel.Open=!1);i.topPanel={panel:o.Panel.Name,statut:!o.Panel.Open};o.Panel.Open=!o.Panel.Open;o.Panel.Open&&u.trackEvent("Global - Onglets - Ouverture recherche client")};o.onSelect=function(n){o.client=n;o.niveau=n.Niveau;o.isClientNew=n.IsClientNew;o.isCapa=n.IsClientCapa;o.idCapa=n.IdClientCapa;o._siren=n.Siren;o.isCapa&&sessionStorage.setItem("Epilot.RechercheClientCapaId",JSON.stringify(n.IdClientCapa));o.isClientNew&&sessionStorage.setItem("Epilot.RechercheClientCodeClientSommet",JSON.stringify(n.CodeClient));f.getDomaines(n.Siren,o.niveau).then(function(n){n.status==200&&(o.domaines=n.data,o.parcNotExist=n.data.length>0?!1:!0)})};o.export=function(n){console.log(n);var t=epilotproperties.getWebServiceUrl()+"/RechercheClient/ExportParc/"+o._siren+"/"+o.niveau+"/"+n;window.open(t,"_blank")};o.searchClient=function(n){return n?(o.niveau=o.isGroupe?"G":"E",f.getClients(o.niveau,n).then(function(n){if(n.status==200)return n.data})):[]};o.openCaParc=function(){if(o.isCapa){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheClientCaParc.aspx";window.open(n,"_blank")}};o.openFicheClient=function(){if(o.isClientNew){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheClient.aspx";window.open(n,"_blank")}};o.onChange=function(){o.domaines=[];o.isCapa=!1;o.parcNotExist=!1};o.openPmdLink=function(){var n,t;u.trackEvent("Global - Onglets - Ouverture lien PMD");n=JSON.parse(sessionStorage.getItem("Epilot.RechercheClientCodeClientSommet"));n.startsWith("E")&&(t=$("#PropertyPmdReportUrl").text()+"&filter=VM_TIERS%2fENTRPRS_ID%20eq '"+n.substring(1)+"'",window.open(t,"_blank"));n.startsWith("G")&&(t=$("#PropertyPmdReportUrl").text()+"&filter=VM_TIERS%2fGROUPE_ID%20eq '"+n.substring(1)+"'",window.open(t,"_blank"))};o.onSelectActeur=function(n){o.acteur=n;sessionStorage.setItem("Epilot.RechercheActeurCodeAlliance",JSON.stringify(n.CodeActeur))};o.searchActeur=function(n){return n?f.getActeurs(n).then(function(n){if(n.status==200)return n.data}):[]};o.openFicheActeur=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheActeur.aspx";window.open(n,"_blank")};o.openBenchClient=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/BenchClient.aspx";window.open(n,"_blank")};o.openBenchVendeur=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/BenchVendeur.aspx";window.open(n,"_blank")};o.onChangeActeur=function(){};o.onSelectProduit=function(n){o.produit=n;sessionStorage.setItem("Epilot.RechercheProduitCode",JSON.stringify(n.CodeProduit))};o.searchProduit=function(n){return n?f.getProduits(n).then(function(n){if(n.status==200)return n.data}):[]};o.openFicheProduit=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheProduit.aspx";window.open(n,"_blank")};o.onChangeProduit=function(){};o.jQueryScrollbarOptions={onScroll:function(){}};o.initializePage()});orangeCommonApp.app.controller("telechargementAddNewController",function(n,t,i,r,u,f){n.Page=n.Page||{};n.Url=n.Url||{};n.Telechargement=n.Telechargement||{};n.Page.Init=function(){var t=n.Url.GetId(),i=n.Url.GetParam();t?n.Telechargement.Save(t,i).then(function(t){t.status==200&&t.data==null?(f.put("EPilot.Telechargement.Update",!0,{path:"/"}),n.Page.Close()):(alert(t.data.Erreurs),n.Page.Close())}):(alert('Une erreur est survenue. Paramètre "id" manquant dans l url.'),n.Page.Close())};n.Page.Close=function(){try{window.open("","_parent","");window.close()}catch(n){}try{this.focus();self.opener=this;self.close()}catch(n){}try{window.open("","_self","");window.close()}catch(n){}};n.Telechargement.Save=function(n,t){var i=epilotproperties.getWebServiceUrl()+"Telechargements/New/"+n+"/"+t;return u.get(i)};n.Url.GetId=function(){return n.Url.GetParameters("id")};n.Url.GetParam=function(){return n.Url.GetParameters("param")};n.Url.GetParameters=function(n){for(var f=decodeURIComponent(window.location.search.substring(1)),r=f.split("&"),i,u,t=0;t<r.length;t++)if(i=r[t].split("="),i[0]===n)return u=i[0].length+1,i[1]===undefined?!0:r[t].substring(u)};n.Page.Init()});orangeCommonApp.app.controller("homeController",function(n,t,i,r,u){n.moduleId;n.homePage;n.message="Redirection en cours de chargement...";n.initializePage=function(t){u.getByModule(t).then(function(t){n.homePage=t.data.PageUrl;n.homePage!=null&n.homePage!="undefined"?window.location.replace(n.homePage):n.message="Aucune redirection configurée. Séléectionner un menu sur la gauche."})}});orangeCommonApp.app.controller("homeNavController",function(n,t,i,r,u,f,e,o){var s=this;s.Panel=s.Panel||{};s.Panel.Name="recherche-client";s.Panel.Open=!1;t("displayTopController",{$scope:s});s.siren;s._siren;s.selectedActeur;s.selectedProduit;s.selectedClient;s.niveau="";s.domaines=[];s.canAccess=!1;s.isCapa=!1;s.isClientNew=!1;s.idCapa;s.acteur={};s.produit={};s.client={};s.isClient=!0;s.isActeur=!1;s.isProduit=!1;s.isVendeur=!1;s.baseUrl=window.location.origin;s.listBlocs=[];s.listBlocsItems=[];s.toggleBtn=function(n){n==1&&(s.isClient=!0,s.isActeur=!1,s.isProduit=!1);n==2&&(s.isClient=!1,s.isActeur=!0,s.isProduit=!1);n==3&&(s.isClient=!1,s.isActeur=!1,s.isProduit=!0)};s.initializePage=function(){e.getUser().then(function(n){if(n.status==200&&n.data){s.isVendeur=n.data.PopulationCode=="IC"||n.data.PopulationCode=="RCT"||n.data.PopulationCode=="AM"||n.data.PopulationCode=="AUTRES-VENDEURS"||n.data.PopulationCode=="ICS"?!0:!1;var t=$("#PropertyFicheClientRestrictedAccess").text().split(";").filter(Boolean);t.indexOf(n.data.PopulationCode)==-1?$("#home-recherche-client").show():$("#home-recherche-client").hide();o.getAllBlocs().then(function(t){var i,r;if(t.data.length>0)for(i=0;i<t.data.length;i++)r=t.data[i].Populations.split(";"),(t.data[i].Populations==""||r.indexOf(n.data.PopulationCode)>-1)&&s.listBlocs.push(t.data[i])});o.getAllBlocItems().then(function(t){var i,r;if(t.data.length>0)for(i=0;i<t.data.length;i++)r=t.data[i].Populations.split(";"),(t.data[i].Populations==""||r.indexOf(n.data.PopulationCode)>-1)&&s.listBlocsItems.push(t.data[i])})}})};s.Panel.Display=function(){i.topPanel&&i.topPanel.panel==s.Panel.Name||(s.Panel.Open=!1);i.topPanel={panel:s.Panel.Name,statut:!s.Panel.Open};s.Panel.Open=!s.Panel.Open;s.Panel.Open&&u.trackEvent("Global - Onglets - Ouverture recherche client")};s.onSelect=function(n){s.client=n;s.niveau=n.Niveau;s.isClientNew=n.IsClientNew;s.isCapa=n.IsClientCapa;s.idCapa=n.IdClientCapa;s._siren=n.Siren;s.isCapa&&sessionStorage.setItem("Epilot.RechercheClientCapaId",JSON.stringify(n.IdClientCapa));s.isClientNew&&sessionStorage.setItem("Epilot.RechercheClientCodeClientSommet",JSON.stringify(n.CodeClient));f.getDomaines(n.Siren,s.niveau).then(function(n){n.status==200&&(s.domaines=n.data,s.parcNotExist=n.data.length>0?!1:!0)})};s.export=function(n){console.log(n);var t=epilotproperties.getWebServiceUrl()+"/RechercheClient/ExportParc/"+s._siren+"/"+s.niveau+"/"+n;window.open(t,"_blank")};s.searchClient=function(n){return n?(s.niveau=s.isGroupe?"G":"E",f.getClients(s.niveau,n).then(function(n){if(n.status==200)return n.data})):[]};s.openCaParc=function(){if(s.isCapa){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheClientCaParc.aspx";window.open(n,"_blank")}};s.openFicheClient=function(){if(s.isClientNew){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheClient.aspx";window.open(n,"_blank")}};s.onChange=function(){s.domaines=[];s.isCapa=!1;s.parcNotExist=!1};s.openPmdLink=function(){var n,t;u.trackEvent("Global - Onglets - Ouverture lien PMD");n=JSON.parse(sessionStorage.getItem("Epilot.RechercheClientCodeClientSommet"));n.startsWith("E")&&(t=$("#PropertyPmdReportUrl").text()+"&filter=VM_TIERS%2fENTRPRS_ID%20eq '"+n.substring(1)+"'",window.open(t,"_blank"));n.startsWith("G")&&(t=$("#PropertyPmdReportUrl").text()+"&filter=VM_TIERS%2fGROUPE_ID%20eq '"+n.substring(1)+"'",window.open(t,"_blank"))};s.onSelectActeur=function(n){s.acteur=n;sessionStorage.setItem("Epilot.RechercheActeurCodeAlliance",JSON.stringify(n.CodeActeur))};s.searchActeur=function(n){return n?f.getActeurs(n).then(function(n){if(n.status==200)return n.data}):[]};s.openFicheActeur=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheActeur.aspx";window.open(n,"_blank")};s.openBenchClient=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/BenchClient.aspx";window.open(n,"_blank")};s.openBenchVendeur=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/BenchVendeur.aspx";window.open(n,"_blank")};s.onChangeActeur=function(){};s.onSelectProduit=function(n){s.produit=n;sessionStorage.setItem("Epilot.RechercheProduitCode",JSON.stringify(n.CodeProduit))};s.searchProduit=function(n){return n?f.getProduits(n).then(function(n){if(n.status==200)return n.data}):[]};s.openFicheProduit=function(){var n=window.location.protocol+"//"+window.location.host+"/perfco/_layouts/15/Orange.EPilot/Pages/RechercheProduit.aspx";window.open(n,"_blank")};s.onChangeProduit=function(){};s.jQueryScrollbarOptions={onScroll:function(){}};s.initializePage()});orangeCommonApp.app.controller("desabonnementController",function(n,t,i,r,u){var f=this;f.initializePage=function(){u.desabonnement().then(function(n){n.status==200&&i.open({animation:!0,templateUrl:"/_layouts/15/Orange.Common/Design/Scripts/app/views/infosPopup.html?version=EPilotCurrentVersion",controller:"infosPopupController",controllerAs:"vm",resolve:{titleToShow:function(){return undefined},textToShow:function(){return undefined},htmlToShow:function(){return"Votre demande a bien été prise en compte. \n Vous ne recevrez plus les newsletters."}}})})};f.jQueryScrollbarOptions={onScroll:function(){}};f.initializePage()});